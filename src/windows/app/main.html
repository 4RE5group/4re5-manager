<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4re5 manager | main</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" data-tag="font">
    <style>
        :root {
            --color-text: #798ca3;
            --color-background1: #263345;
            --color-background2: #202a3b;
            --color-dark: #1b2430;
            --color-darker: #1e1e1e;
            --color-orange: #FF8500;
            --color-red: #ed1c24;

            --menu-width: 50px;
            --menu-width-open: calc(35px + 107px + var(--menu-width));
        }

        body {
            font-family: Inter;
            font-size: 16px;
            overflow: hidden;
            padding: 0px;
            margin: 0px;
            display: flex;
            flex-direction: row;
        }

        .menu {
            width: var(--menu-width);
            justify-content: center;
            height: 100vh;
            background: var(--color-darker);
            flex-direction: column;
            display: flex;

            #menu-icon:hover {
                cursor: pointer;
            }
            #menu-icon {
                margin: 8px 0px 0px 8px;
            }

            .menu-container {
                width: 100%;
                height: 100vh;
                display: flex;
                flex-direction: column;
                margin-top: 20px;
                padding-left: 8px;
                overflow: hidden;
                gap: 20px;

                span {
                    text-wrap: nowrap;
                    gap: 10px;
                    align-items: center;
                    color: white;
                    width: var(--menu-width-open);
                    display: flex;
                    flex-direction: row;
                }

                span:hover {
                    cursor: pointer;
                }
            }
        }

        .content {
            width: calc(100% - var(--menu-width));
            height: 100vh;
            background: var(--color-background1);

            .panel {
                height: 100vh;
            }

            #appview {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                grid-template-rows: max-content;
                width: 100%;
                /* padding: 20px; */
                gap: 10px;
                overflow-y: scroll;
                height: 100vh;

                .app {
                    flex-direction: column;
                    display: flex;
                    align-items: center;
                    width: 100px;

                    img {
                        width: 100px;
                        height: 70px;
                        object-fit: contain;
                    }

                    span {
                        color: white;
                        height: 50px;
                    }
                }

                .app:hover {
                    cursor: pointer;
                }
            }
        }
        .bottomsheet {
            /* bottom: 0px; */
            color: white;
            z-index: 999;
            position: absolute;
            width: calc(100% - var(--menu-width));
            background-color: #212121;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 40px 40px 0px 0px;

            /* disable selection */
            user-select: none; /* Standard syntax */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE/Edge */

            .draggable_zone {
                width: 100%;
                height: auto;
                cursor: pointer;
                align-items: center;
                display: flex;
                justify-content: center;
            }

            .indicator {
                border-radius: 100px;
                background-color: #eeeeee;
                height: 6px;
                width: 40px;
                margin-top: 12px;
                margin-bottom: 18px;
            }
            .header {
                margin: 0px 20px 0px 20px;
                width: calc(100% - 40px);
            }
            #app_icon {
                margin-right: 20px;
                width: 100px;
                height: 100px;
                float: left;
            }

            .row {
                padding: 0px 20px 0px 20px;
                width: calc(100% - 40px);
                justify-content: space-between;
                display: flex;
                flex-direction: row;
            }

            .author {
                padding: 8px;
                background-color: var(--color-orange);
                border-radius: 20px;
                cursor: pointer;
                text-decoration: none;
                color: white;
            }

            .button {
                max-width: 400px;
                width: calc(100% - 40px);
                background-color: var(--color-red);
                border-radius: 15px;
                font-size: 22px;
                color: white;
                padding: 12px;
                border: 0px;
                margin-top: 20px;
                cursor: pointer;
            }
        }
    </style>
</head>
<body>
    <div class="menu">
        <svg id="menu-icon" width="35px" height="35px" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" fill="var(--color-text)"></svg>
        <div class="menu-container">
            <span>
                <svg fill="#ffffff" height="35px" width="35px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <g> <g> <path d="M430.184,194.351v-93.802c0-10.345-8.387-18.732-18.732-18.732h-97.561C305.091,35.294,264.136,0,215.091,0 c-49.043,0-89.998,35.294-98.799,81.818H18.732C8.387,81.818,0,90.204,0,100.549v110.786c0,10.345,8.387,18.732,18.732,18.732 c34.785,0,63.085,28.3,63.085,63.086s-28.3,63.085-63.085,63.085C8.387,356.237,0,364.624,0,374.969v118.299 C0,503.613,8.387,512,18.732,512h114.543c10.345,0,18.732-8.387,18.732-18.732c0-34.785,28.3-63.086,63.085-63.086 s63.086,28.3,63.086,63.086c0,10.345,8.387,18.732,18.732,18.732h114.543c10.345,0,18.732-8.387,18.732-18.732V391.951 c46.523-8.801,81.816-49.756,81.816-98.8C512,244.108,476.707,203.153,430.184,194.351z"></path> </g> </g> </g></svg>
                Mods
            </span>
            <span>
                <svg viewBox="0 0 24 24" width="35px" height="35px" fill="none" xmlns="http://www.w3.org/2000/svg"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <path d="M17 18.9999C18.2496 18.9715 19.4432 18.4759 20.3456 17.611C21.2481 16.7462 21.7939 15.5746 21.8754 14.3273C21.957 13.0801 21.5684 11.8475 20.7863 10.8725C20.0042 9.89749 18.8852 9.25073 17.65 9.05975C17.1768 7.73466 16.2529 6.61822 15.0399 5.90521C13.8269 5.19221 12.4019 4.92799 11.0139 5.15912C9.62597 5.39024 8.36341 6.102 7.4469 7.16962C6.53039 8.23724 6.01826 9.59301 6 10.9999C4.93913 10.9999 3.92172 11.4212 3.17157 12.1713C2.42142 12.9215 2 13.9391 2 14.9999C2 16.0608 2.42142 17.0782 3.17157 17.8283C3.92172 18.5785 4.93913 18.9999 6 18.9999H17Z" stroke="#ffffff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                4re5net
            </span>
            <span>
                <svg xmlns="http://www.w3.org/2000/svg" width="35px" height="35px" fill="#ffffff" viewBox="0 0 24 24" stroke="#ffffff"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></g></svg>
                Home
            </span>
            <span>
                <svg fill="#ffffff" width="35px" height="35px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff" stroke-width="0.00024000000000000003"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g><path d="M20.995 6.9a.998.998 0 0 0-.548-.795l-8-4a1 1 0 0 0-.895 0l-8 4a1.002 1.002 0 0 0-.547.795c-.011.107-.961 10.767 8.589 15.014a.987.987 0 0 0 .812 0c9.55-4.247 8.6-14.906 8.589-15.014zM12 19.897V12H5.51a15.473 15.473 0 0 1-.544-4.365L12 4.118V12h6.46c-.759 2.74-2.498 5.979-6.46 7.897z"></path></g></svg>
                Authenticator
            </span>
            <span>
                <svg fill="#ffffff" width="35px" height="35px" viewBox="0 0 1920 1920" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <path d="M1703.534 960c0-41.788-3.84-84.48-11.633-127.172l210.184-182.174-199.454-340.856-265.186 88.433c-66.974-55.567-143.323-99.389-223.85-128.415L1158.932 0h-397.78L706.49 269.704c-81.43 29.138-156.423 72.282-223.962 128.414l-265.073-88.32L18 650.654l210.184 182.174C220.39 875.52 216.55 918.212 216.55 960s3.84 84.48 11.633 127.172L18 1269.346l199.454 340.856 265.186-88.433c66.974 55.567 143.322 99.389 223.85 128.415L761.152 1920h397.779l54.663-269.704c81.318-29.138 156.424-72.282 223.963-128.414l265.073 88.433 199.454-340.856-210.184-182.174c7.793-42.805 11.633-85.497 11.633-127.285m-743.492 395.294c-217.976 0-395.294-177.318-395.294-395.294 0-217.976 177.318-395.294 395.294-395.294 217.977 0 395.294 177.318 395.294 395.294 0 217.976-177.317 395.294-395.294 395.294" fill-rule="evenodd"></path> </g></svg>
                Settings
            </span>
        </div>
    </div>

    <div class="content">
        <div class="panel" id="home">
            <div style="width: 100%; align-items: center;">
                <span style="color: var(--color-text);">4re5 apps</span>
                <svg onclick="update()" width="35px" height="35px" fill="var(--color-text)" viewBox="0 0 24 24" id="update" data-name="Flat Line" xmlns="http://www.w3.org/2000/svg" class="icon flat-line"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g><path id="primary" d="M4,12A8,8,0,0,1,18.93,8" style="fill: none; stroke: var(--color-text); stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></path><path id="primary-2" data-name="primary" d="M20,12A8,8,0,0,1,5.07,16" style="fill: none; stroke: var(--color-text); stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></path><polyline id="primary-3" data-name="primary" points="14 8 19 8 19 3" style="fill: none; stroke: var(--color-text); stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></polyline><polyline id="primary-4" data-name="primary" points="10 16 5 16 5 21" style="fill: none; stroke: var(--color-text); stroke-linecap: round; stroke-linejoin: round; stroke-width: 2;"></polyline></g></svg>
            </div>
            
            <div id="appview">
                <!-- apps here -->
            </div>
            <div class="bottomsheet">
                <div class="draggable_zone">
                    <div class="indicator"></div>
                </div>
                <div class="header">
                    <img id="app_icon">
                    <p id="app_name">AppName</p>
                    <p id="app_description">Desc</p>
                </div>
                <div class="row">
                    <p id="app_first_release">first release: 01-01-1970</p>
                    <p id="app_version">version: 1.0</p>
                </div>
                <div class="row">
                    <p>author: <span id="app_author" class="author">@4re5 group</span></p>
                    <svg id="app_github" width="35" height="35" viewBox="0 -3.5 256 256" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMinYMin meet" fill="#ffffff"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g > <g fill="#ffffff"> <path d="M127.505 0C57.095 0 0 57.085 0 127.505c0 56.336 36.534 104.13 87.196 120.99 6.372 1.18 8.712-2.766 8.712-6.134 0-3.04-.119-13.085-.173-23.739-35.473 7.713-42.958-15.044-42.958-15.044-5.8-14.738-14.157-18.656-14.157-18.656-11.568-7.914.872-7.752.872-7.752 12.804.9 19.546 13.14 19.546 13.14 11.372 19.493 29.828 13.857 37.104 10.6 1.144-8.242 4.449-13.866 8.095-17.05-28.32-3.225-58.092-14.158-58.092-63.014 0-13.92 4.981-25.295 13.138-34.224-1.324-3.212-5.688-16.18 1.235-33.743 0 0 10.707-3.427 35.073 13.07 10.17-2.826 21.078-4.242 31.914-4.29 10.836.048 21.752 1.464 31.942 4.29 24.337-16.497 35.029-13.07 35.029-13.07 6.94 17.563 2.574 30.531 1.25 33.743 8.175 8.929 13.122 20.303 13.122 34.224 0 48.972-29.828 59.756-58.22 62.912 4.573 3.957 8.648 11.717 8.648 23.612 0 17.06-.148 30.791-.148 34.991 0 3.393 2.295 7.369 8.759 6.117 50.634-16.879 87.122-64.656 87.122-120.973C255.009 57.085 197.922 0 127.505 0"></path> <path d="M47.755 181.634c-.28.633-1.278.823-2.185.389-.925-.416-1.445-1.28-1.145-1.916.275-.652 1.273-.834 2.196-.396.927.415 1.455 1.287 1.134 1.923M54.027 187.23c-.608.564-1.797.302-2.604-.589-.834-.889-.99-2.077-.373-2.65.627-.563 1.78-.3 2.616.59.834.899.996 2.08.36 2.65M58.33 194.39c-.782.543-2.06.034-2.849-1.1-.781-1.133-.781-2.493.017-3.038.792-.545 2.05-.055 2.85 1.07.78 1.153.78 2.513-.019 3.069M65.606 202.683c-.699.77-2.187.564-3.277-.488-1.114-1.028-1.425-2.487-.724-3.258.707-.772 2.204-.555 3.302.488 1.107 1.026 1.445 2.496.7 3.258M75.01 205.483c-.307.998-1.741 1.452-3.185 1.028-1.442-.437-2.386-1.607-2.095-2.616.3-1.005 1.74-1.478 3.195-1.024 1.44.435 2.386 1.596 2.086 2.612M85.714 206.67c.036 1.052-1.189 1.924-2.705 1.943-1.525.033-2.758-.818-2.774-1.852 0-1.062 1.197-1.926 2.721-1.951 1.516-.03 2.758.815 2.758 1.86M96.228 206.267c.182 1.026-.872 2.08-2.377 2.36-1.48.27-2.85-.363-3.039-1.38-.184-1.052.89-2.105 2.367-2.378 1.508-.262 2.857.355 3.049 1.398"></path> </g> </g></svg>
                </div>
                <div class="row">
                    <p>under license: <span id="app_license"></span></p>
                </div>
                <button class="button" id="app_install" onclick="install()">install</button>
                <button class="button" id="app_uninstall">uninstall</button>
            </div>
        </div>
    </div>

    <script>
        // 4re5 group, all rights reserved
        var icon_menu_close = `<g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g>  <g id="Layer_2" data-name="Layer 2"> <g id="invisible_box" data-name="invisible box"> <rect width="48" height="48" fill="none"></rect> </g> <g id="icons_Q2" data-name="icons Q2"> <path d="M26.8,24,37.4,13.5a2.1,2.1,0,0,0,.2-2.7,1.9,1.9,0,0,0-3-.2L24,21.2,13.4,10.6a1.9,1.9,0,0,0-3,.2,2.1,2.1,0,0,0,.2,2.7L21.2,24,10.6,34.5a2.1,2.1,0,0,0-.2,2.7,1.9,1.9,0,0,0,3,.2L24,26.8,34.6,37.4a1.9,1.9,0,0,0,3-.2,2.1,2.1,0,0,0-.2-2.7Z"></path> </g> </g> </g>`;
        var icon_menu_open = `<g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g> <g data-name="Layer 2"> <g data-name="invisible box"> <rect width="48" height="48" fill="none"></rect> </g> <g data-name="icons Q2"> <g> <path d="M42,12a2,2,0,0,1-2,2H8a2,2,0,0,1-2-2H6a2,2,0,0,1,2-2H40a2,2,0,0,1,2,2Z"></path> <path d="M42,24a2,2,0,0,1-2,2H8a2,2,0,0,1-2-2H6a2,2,0,0,1,2-2H40a2,2,0,0,1,2,2Z"></path> <path d="M42,36a2,2,0,0,1-2,2H8a2,2,0,0,1-2-2H6a2,2,0,0,1,2-2H40a2,2,0,0,1,2,2Z"></path> </g> </g> </g> </g>`;

        var menu_icon = document.getElementById("menu-icon");
        var menu = document.querySelector(".menu");
        var menu_container = document.querySelector(".menu-container");
        var app_view = document.getElementById("appview");
        var bottomsheet = document.querySelector(".bottomsheet");
        var bottomsheet_dragzone = document.querySelector(".draggable_zone");

        var repo = new Map(); // init repo map
        var current_app; // current application
        var defaultImage = "https://raw.githubusercontent.com/4RE5group/4re5-repository/refs/heads/main/default.png";

        // init menu icon
        menu_icon.innerHTML = icon_menu_open;

        menu_icon.addEventListener("click", function () {
            // if opened
            if (menu.style.width == "var(--menu-width-open)")
            {
                menu.style.width = "var(--menu-width)";
                menu_icon.innerHTML = icon_menu_open;
            }
            else // if closed
            {
                menu.style.width = "var(--menu-width-open)";
                menu_icon.innerHTML = icon_menu_close;
            }
        });

        var callStack = []; // map array of callbacks for message listeners
        window.chrome.webview.addEventListener("message", (event) => {
            var name = event.data.split(":")[0];
            var message = event.data.replaceAll(name+":", "");
            if (name == "log") // handle log message
            {
                console.log("4re5-manager: "+message);
                return;
            }
            callStack.forEach(map => {
                if (name == map.name)
                {
                    map.callback(message);
                    const index = callStack.indexOf(map);
                    if (index > -1) { // only splice array when item is found
                        callStack.splice(index, 1);
                    }
                    return;
                }
            });
        });

        function awaitMessage(callback, func, ...args)
        {
            // append order of the message
            callStack.push({
                "name": func,
                "callback": callback
            });
            if (typeof window.chrome.webview.hostObjects.aresAPI[func] === "function") {
                window.chrome.webview.hostObjects.aresAPI[func](...args);
            } else {
                console.error(`Function ${func} does not exist.`);
            }
        }

        // app view loader
        window.addEventListener("load", function (){
            awaitMessage(result => {
                LoadApps(JSON.parse(result));
            }, "GetRepo", false);
        });


        // bottomsheet movement listener
        let is_dragging = false;
        let startY = 0;
        let startTop = 0;

        // Use pointer events for better touch/mouse support
        bottomsheet_dragzone.addEventListener("pointerdown", (e) => {
            is_dragging = true;
            startY = e.clientY;
            startTop = bottomsheet.getBoundingClientRect().top;
            e.preventDefault(); // Prevent text selection or other default behaviors
        });

        document.addEventListener("pointerup", () => {
            is_dragging = false;
        });

        document.addEventListener("pointermove", (e) => {
            if (!is_dragging) return;

            // Calculate new position
            const newTop = startTop + (e.clientY - startY);
            const minTop = document.body.clientHeight - bottomsheet.clientHeight; // Fully expanded
            const maxTop = document.body.clientHeight - 30; // Collapsed (30px visible)

            // Clamp the position between min and max
            const clampedTop = Math.min(Math.max(newTop, minTop), maxTop);

            // Apply the new position
            bottomsheet.style.top = clampedTop + 'px';
        });

        function LoadApps(json) {
            app_view.innerHTML = "";
            repo = json;
            repo.forEach(app => {
                if (app.disabled == "true")
                    return;

                app_view.innerHTML += `
                <div class="app" onclick="viewApp('${app.package}')">
                    <img src="${(app.image == "")?defaultImage:app.image}">
                    <span>${app.name}</span>
                </div>`;
            }); 
        }

        function update()
        {
            awaitMessage(result => {
                LoadApps(JSON.parse(result));
            }, "GetRepo", true);
        }

        function install()
        {
            if (current_app == null) {
                console.error("an error occured: current_app is null");
                return;
            }
            awaitMessage(result => {
                alert(result);
            }, "Install", JSON.stringify(current_app));
        }

        function viewApp(package)
        {
            // find map that has this package name in repo
            current_app = null;
            repo.forEach(elem => {
                if (elem.package == package)
                {
                    current_app = elem;
                    return;
                }
            });
            if (current_app == null)
                return;
            let version = "not available for windows yet";
            let platform;
            current_app.platform.forEach(p => {
                if (p.platformid == 0) {
                    platform = p;
                    version = "version: "+platform.version;
                }
            });
            document.getElementById("app_icon").src = (current_app.image == "")?defaultImage:current_app.image;
            document.getElementById("app_name").innerText = current_app.name;
            document.getElementById("app_description").innerText = current_app.description;
            document.getElementById("app_github").onclick = () => {
                openLink(current_app.github);
            };
            document.getElementById("app_author").innerText = "@"+current_app.author;
            document.getElementById("app_author").onclick = () => {
                openLink("https://github.com/"+current_app.author.replaceAll(" ", ""));
            };
            document.getElementById("app_first_release").innerText = "first release: "+current_app.first_date;
            document.getElementById("app_version").innerText = version;
            document.getElementById("app_license").innerText = current_app.license;

            // check if installed
            awaitMessage(current_version => {
                if (parseFloat(current_version) == -1.0) // if not installed
                {
                    document.getElementById("app_install").onclick = () => {
                        install();
                    };
                    document.getElementById("app_install").innerText = "install";
                }
                else
                {
                    let float_last_version = platform.version.replace(".", "#");
                    float_last_version = float_last_version.replaceAll(".", "");
                    float_last_version = parseFloat(float_last_version.replace("#", "."));
                    if (float_last_version > parseFloat(current_version))
                    {
                        document.getElementById("app_install").innerText = "update";
                        document.getElementById("app_install").onclick = () => {
                            install();
                        };
                    }
                    else
                    {
                        document.getElementById("app_install").innerText = "launch";
                        document.getElementById("app_install").onclick = () => {
                            launch(current_app.package);
                        };
                    }
                }
                bottomsheet.style.top = (document.body.clientHeight - bottomsheet.clientHeight) + 'px';
            }, "GetPackageVersion", current_app.package);
        }
        function openLink(link)
        {
            awaitMessage(result => {
                console.log("openLink: "+result);
            }, "openLink", link);
        }
        function launch(package)
        {
            awaitMessage(result => {
                console.log("launching status: "+result);
            }, "launchPackage", package);
        }
    </script>
</body>
</html>